{% extends 'base.html' %}

{% block filters %}
    <ul>
        <li>Filters will</li>
        <li>go here</li>
    </ul>
{% endblock filters %}

{% block before_head_close %}
        <link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}css/hackplot.css" />
        <style type="text/css">
        .mapTooltip {
            position : fixed;
            background-color : #fff;
            moz-opacity:0.70;
            opacity: 0.70;
            filter:alpha(opacity=70);
            border-radius:10px;
            padding : 10px;
            z-index: 1000;
            max-width: 200px;
            display:none;
            color:#343434;
        }
        </style>
{% endblock before_head_close %}

{% block maincontent %}
    <div id="hackplot_chart" style="width:100%;height:480px">
<div class="map">Alternative content</div>
    </div>
{% endblock maincontent %}

{% block before_body_close %}
    <script type="text/javascript" src="{{ STATIC_URL }}js/raphael-min.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/jquery.mapael.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/maps/world_countries.js"></script>
    <script type="text/javascript">
        $.getJSON('{% url "hackplot_api:list" %}', function(data){
            geoPlots = {};
            $.each(data.results, function(index, result){
                newPlot = {
                    type: 'circle',
                    size: 5,
                    latitude: result.latitude,
                    longitude: result.longitude,
                    attrs: {
                        opacity: 1
                    },
                    tooltip: {
                        content: '<span style="font-weight: bold;">' + result.ip_address + '</span><br/>' + result.attempts.length
                    }
                }
                geoPlots[result.ip_address] = newPlot
            });

            $('#hackplot_chart').mapael({
                map : {
                    name : "world_countries"
                },
                plots: geoPlots
            });
        });
    </script>
{% endblock before_body_close %}
